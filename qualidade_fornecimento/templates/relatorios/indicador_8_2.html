{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block content %}
{% include 'partials/global/_estilos_impressao.html' %}
{% include 'partials/global/_styles_componentes.html' %}
{% include 'partials/global/_botao_impressao.html' %}

<div class="container pdf-container">
  <!-- Filtro -->
  <form method="get" class="mb-4 d-print-none">
    <div class="row g-2 align-items-end">
      <div class="col-auto">
        <label for="ano" class="form-label mb-0"><i class="bi bi-calendar me-1"></i> Ano:</label>
        <input type="number" name="ano" id="ano" class="form-control" value="{{ ano }}">
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-funnel-fill me-1"></i> Filtrar
        </button>
      </div>
    </div>
  </form>

  <!-- Cabe√ßalho -->
  <div class="header mb-4">
    <table class="info-table">
      <tr>
        <td style="width: 20%; text-align: center;">
          <img src="/static/logo.png" alt="Logo Bras-Mol" style="max-width: 60px;">
        </td>
        <td style="width: 60%; text-align: center;">
          <strong>üìä Indicador:</strong><br>8.2 - Compras X Faturamento
        </td>
        <td style="width: 20%; text-align: center;">
          <strong>Respons√°vel:</strong><br>Gilberto Fernandes
        </td>
      </tr>
      <tr>
        <td colspan="2"><strong>üéØ Objetivo:</strong> Monitorar o custo de mat√©ria prima em rela√ß√£o ao faturamento.</td>
        <td class="text-center"><strong>üéØ Meta:</strong><br> ‚â§ 30%</td>
      </tr>
    </table>
  </div>

  <!-- Gr√°fico + M√©dia -->
  <div class="grafico-midia-container d-flex flex-column flex-md-row justify-content-between align-items-start gap-4">
    <div class="grafico-box" style="flex:0 0 65%;">
      {% if grafico_base64 %}
        <img src="data:image/png;base64,{{ grafico_base64 }}" class="img-fluid border rounded shadow-sm">
      {% else %}
        <p class="text-muted">Sem dados dispon√≠veis.</p>
      {% endif %}
    </div>
    <div class="media-box" style="flex:0 0 33%;">
      <div class="media-card p-3 bg-light rounded shadow-sm border h-100">
        <table class="table table-bordered text-center mb-0">
          <thead class="table-light"><tr><th colspan="2">üìä M√©dia Geral</th></tr></thead>
          <tbody>
            <tr>
              <td>√çndice</td>
              <td style="{% if media <= 30 %}color:green{% else %}color:red{% endif %}">
                <strong>{{ media|floatformat:2 }}%</strong>
                {% if media <= 30 %} ‚úÖ {% else %} ‚ö†Ô∏è {% endif %}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tabela -->
  <div class="table-responsive mt-4">
    <table class="table table-bordered text-center align-middle custom-table">
      <thead class="table-light">
        <tr>
          <th>Trimestre</th>
          <th>Compras (R$)</th>
          <th>Faturamento (R$)</th>
          <th>√çndice (%)</th>
        </tr>
      </thead>
      <tbody>
        {% for t, valores in dados.items %}
        <tr>
          <td>{{ t }}</td>
          <td>{{ valores.compras|floatformat:2 }}</td>
          <td>{{ valores.faturamento|floatformat:2 }}</td>
          <td>{{ valores.indice|floatformat:2 }}%</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Coment√°rios -->
  <div class="analise-dados mt-4">
    <h5 class="text-center text-primary">üìå An√°lise de Dados</h5>
    <ul>
      {% for comentario in comentarios %}
        <li><strong>{{ comentario.data }}:</strong> {{ comentario.texto }}</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Forma de c√°lculo -->
  <div class="mt-5 text-center">
    <div class="border-start border-3 border-success ps-4 py-3 bg-light rounded shadow-sm d-inline-block">
      <h6><i class="bi bi-calculator"></i> Forma de C√°lculo</h6>
      <div>Valor gasto no per√≠odo √∑ Faturamento no per√≠odo √ó 100</div>
    </div>
  </div>

  <!-- Plano de a√ß√£o -->
  <div class="plano-acao mt-5">
    <h5 class="text-center mb-3 text-warning"><i class="bi bi-tools"></i> Plano de A√ß√£o</h5>
    <table class="table table-bordered text-center">
      <thead><tr><th>Item</th><th>A√ß√£o</th><th>Respons√°vel</th><th>Prazo</th><th>Situa√ß√£o</th></tr></thead>
      <tbody><tr><td>1</td><td>[Descri√ß√£o]</td><td>[Resp.]</td><td>[Prazo]</td><td>[Situa√ß√£o]</td></tr></tbody>
    </table>
  </div>
</div>
{% endblock %}
