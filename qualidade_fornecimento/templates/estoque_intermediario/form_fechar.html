{% extends "base.html" %}
{% block title %}Fechar Item — {{ obj.op }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div class="d-flex align-items-center gap-2">
    <i class="bi bi-check2-circle text-success fs-3"></i>
    <h4 class="mb-0">Fechar Item — OP {{ obj.op }}</h4>
  </div>
  <a class="btn btn-outline-secondary" href="{% url 'ei_list_em_fabrica' %}">
    <i class="bi bi-arrow-left-circle me-1"></i> Voltar
  </a>
</div>

<ul class="list-group small mb-3">
  <li class="list-group-item d-flex justify-content-between"><span>Enviado</span><strong>{{ obj.enviado|floatformat:3 }} kg</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Retorno</span><strong>{{ obj.retorno|floatformat:3 }} kg</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Consumo (balança)</span><strong>{{ obj.consumo_balanca_kg|floatformat:3 }} kg</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Consumo (inferido)</span><strong>{{ obj.consumo_inferido_kg|floatformat:3 }} kg</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Consumo REAL</span><strong>{{ obj.consumo_real_kg|floatformat:3 }} kg</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Sucata</span><strong>{{ obj.sucata|floatformat:3 }} kg ({{ obj.perc_sucata }}%)</strong></li>
  <li class="list-group-item d-flex justify-content-between"><span>Desvio balanço de massa</span><strong>{{ obj.desvio_balanco_percent }}%</strong></li>
</ul>

{% if obj.perc_sucata > obj.tolerancia_sucata_percentual %}
<div class="alert alert-warning">
  <i class="bi bi-exclamation-triangle-fill me-1"></i>
  A sucata ({{ obj.perc_sucata }}%) excede a tolerância ({{ obj.tolerancia_sucata_percentual }}%).
  Informe a justificativa abaixo para permitir o fechamento.
</div>
{% endif %}

<form method="post" class="card shadow-sm">
  <div class="card-body">
    {% csrf_token %}
    {% include "estoque_intermediario/_form_base.html" %}
  </div>
  <div class="card-footer d-flex justify-content-end gap-2">
    <button class="btn btn-success"><i class="bi bi-check2-circle me-1"></i> Fechar</button>
  </div>
</form>
{% endblock %}