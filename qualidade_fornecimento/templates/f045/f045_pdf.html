{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <style>
    @page { size: A4 portrait; margin: 12mm; }
    body { font-family: Arial, sans-serif; font-size: 8.5pt; }

    h3, h4 { text-align: center; margin: 0 0 3pt; }
    table { width: 100%; border-collapse: collapse; font-size: 8pt; }
    th, td { border: 1px solid #000; padding: 2px; text-align: center; }

    .logo { max-height: 50px; }
    .seguranca { max-height: 30px; margin-left: 6px; vertical-align: middle; }

    .circle, .circle-number {
      display: inline-block;
      border: 1px solid #000;
      border-radius: 50%;
      text-align: center;
      font-weight: bold;
      font-size: 8pt;
    }

    .circle { width: 20px; height: 20px; line-height: 20px; margin-bottom: 2px; }
    .circle-number { width: 18px; height: 18px; line-height: 18px; margin-right: 2px; }

    .assinatura { font-size: 8pt; margin-top: 8px; line-height: 1.2; }

    .rodape {
      display: flex;
      justify-content: space-between;
      font-size: 7pt;
      padding-top: 10px;
      border-top: 1px solid #000;
      margin-top: 8px;
    }

    .status-aprovado { color: green; font-weight: bold; }
    .status-condicional { color: orange; font-weight: bold; }
    .status-reprovado { color: red; font-weight: bold; }
  </style>
</head>
<body>

<!-- Cabe√ßalho -->
<table style="margin-bottom: 6px;">
  <tr>
    <td style="width: 20%; padding: 4px;"><img src="{{ logo_url }}" class="logo" alt="Logo"></td>
    <td style="width: 55%; padding: 4px;">
      <div style="display: flex; justify-content: center; align-items: center;">
        <span style="font-size: 12pt; font-weight: bold;">Relat√≥rio de Inspe√ß√£o de Material</span>
        {% if relacao.item_seguranca %}
          <img src="{% static 'seguranca.png' %}" class="seguranca" alt="Seguran√ßa">
        {% endif %}
      </div>
    </td>
    <td style="width: 20%;">
      <div style="font-size: 9pt;">N.¬∫</div>
      <div style="font-size: 16pt; font-weight: bold;">{{ obj.nro_relatorio }}</div>
    </td>
  </tr>
</table>

<!-- Dados do material -->
<h4>üì¶ Dados do Material</h4>
<table style="margin-bottom: 8px;">
  <tr>
    <td colspan="2"><strong>Fornecedor:</strong><br>{{ relacao.fornecedor.nome }}</td>
    <td><strong>NF:</strong><br>{{ relacao.nota_fiscal }}</td>
    <td><strong>Certificado n¬∫:</strong><br>{{ relacao.numero_certificado }}</td>
  </tr>
  <tr>
    <td colspan="2"><strong>Material:</strong><br>{{ relacao.materia_prima.descricao }}</td>
    <td colspan="2">
      <strong>
        {% if relacao.materia_prima.largura %}
          Fita Espessura / Largura (mm):
        {% else %}
          Bitola:
        {% endif %}
      </strong><br>
      {% if relacao.materia_prima.largura %}
        {{ obj.bitola }} ‚Äì {{ relacao.materia_prima.largura }}
      {% else %}
        {{ obj.bitola }}
      {% endif %}
    </td>
  </tr>
  <tr>
    <td><strong>Qtd. rolos:</strong><br>{{ rolos.count }}</td>
    <td>
      <strong>Qtd. carret√©is:</strong><br>
      {% if obj.qtd_carreteis == None or obj.qtd_carreteis == "" or obj.qtd_carreteis == "‚Äî" %}
        N/A
      {% else %}
        {{ obj.qtd_carreteis }}
      {% endif %}
    </td>
    <td><strong>Massa l√≠quida (kg):</strong><br>{{ rolos|calc_peso_total }}</td>
    <td><strong>Pedido Compra:</strong><br>{{ obj.pedido_compra }}</td>
  </tr>
</table>


<!-- Composi√ß√£o Qu√≠mica -->
<h4>üß™ <div class="circle">05</div> Composi√ß√£o Qu√≠mica (%)</h4>
<table>
  <thead>
    <tr><th>Elemento</th><th>Min/Max</th><th>Encontrado</th><th>Laudo</th></tr>
  </thead>
  <tbody>
    {% for item in encontrados %}
    <tr>
   <td style="text-align: center; vertical-align: middle;">
  <div style="display: inline-flex; align-items: center; justify-content: center; gap: 4px;">
    <span style="display: inline-block; border: 1px solid #000; border-radius: 6px; padding: 2px 6px; font-weight: bold; font-size: 8pt;">
      {{ item.sigla }}
    </span>
    <div style="font-size: 7pt;">{{ item.nome_elemento }}</div>
  </div>
</td>





      <td>{{ item.min|stringformat:"0.4f" }} ‚Äì {{ item.max|stringformat:"0.4f" }}</td>
      <td>{{ item.valor|stringformat:"0.4f" }}</td>
      <td>
        {% if item.valor == None or item.valor == "-" or item.valor == "" %}
          <span style="color: green;">‚úîÔ∏è</span>
        {% elif item.ok %}
          <span style="color: green;">‚úîÔ∏è</span>
        {% else %}
          <span style="color: red;">‚ùå</span>
        {% endif %}
      </td>

    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Outras caracter√≠sticas -->
<h4 style="margin-top: 10px;">üìú Outras caracter√≠sticas do certificado</h4>
<table>
  <thead>
    <tr>
      <th><div class="circle">02</div><br>Tra√ß√£o (kgf/mm¬≤)</th>
      <th><div class="circle">06</div><br>Escoamento</th>
      <th><div class="circle">07</div><br>Alongamento (%)</th>
      <th><div class="circle">08</div><br>Estric√ß√£o (%)</th>
      <th><div class="circle">12</div><br>Tor√ß√£o</th>
      <th><div class="circle">11</div><br>Dureza</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>{{ obj.resistencia_tracao|default:"N/A" }}</td>
      <td>{{ obj.escoamento|default:"N/A" }}</td>
      <td>{{ obj.alongamento|default:"N/A" }}</td>
      <td>{{ obj.estriccao|default:"N/A" }}</td>
      <td>{{ obj.torcao_certificado|default:"N/A" }}</td>
      <td>
        {% if obj.dureza_certificado == "‚Äî" or obj.dureza_certificado == None %}
          N/A
        {% else %}
          {{ obj.dureza_certificado }}
        {% endif %}
      </td>
    </tr>
  </tbody>
</table>

<!-- Inspe√ß√£o Interna -->
<h4 style="margin-top: 10px;">üîç Caracter√≠sticas Inspecionadas</h4>
<table>
  <thead>
    <tr>
      <th>Rolo</th><th>Massa</th>
      <th><span class="circle-number">01</span>
        {% if relacao.materia_prima.largura %}
          Esp. / Larg.(mm)
        {% else %}
          Bitola (mm)
        {% endif %}
      </th>
      <th><span class="circle-number">02</span>Tra√ß√£o</th>
      <th><span class="circle-number">11</span>Dureza</th>
      <th><span class="circle-number">03</span>Enrolamento</th>
      <th><span class="circle-number">04</span>Dobramento</th>
      <th><span class="circle-number">12</span>Tor√ß√£o Residual</th>
      <th><span class="circle-number">09</span>Visual</th>
       <th><span class="circle-number">07</span>Alongamento</th>
        <th><span class="circle-number">13</span>Flechamento</th>
      <th>Laudo</th>
    </tr>
  </thead>
  <tbody>
    {% for rolo in rolos %}
    <tr>
      <td>{{ rolo.nro_rolo }}</td>
      <td>{{ rolo.peso|default:"‚Äî" }}</td>
        <td>
  {% if relacao.materia_prima.largura %}
    {% if rolo.bitola_espessura and rolo.bitola_largura %}
      {{ rolo.bitola_espessura|stringformat:"0.2f" }} ‚Äì {{ rolo.bitola_largura|stringformat:"0.2f" }}
    {% elif rolo.bitola_espessura %}
      {{ rolo.bitola_espessura|stringformat:"0.2f" }}
    {% else %}
      ‚Äî
    {% endif %}
  {% else %}
    {% if rolo.bitola_espessura %}
      {{ rolo.bitola_espessura|stringformat:"0.2f" }}
    {% else %}
      ‚Äî
    {% endif %}
  {% endif %}
</td>

      <td>{{ rolo.tracao|default:"‚Äî" }}</td>
      <td>{{ rolo.dureza|default:"‚Äî" }}</td>
      <td>{{ rolo.enrolamento|default:"‚Äî" }}</td>
      <td>{{ rolo.dobramento|default:"‚Äî" }}</td>
      <td>{{ rolo.torcao_residual|default:"‚Äî" }}</td>
      <td>{{ rolo.aspecto_visual|default:"‚Äî" }}</td>
      <td>{{ rolo.alongamento|default:"‚Äî" }}</td>
      <td>{{ rolo.flechamento|default:"‚Äî" }}</td>
      <td>
        {% if rolo.enrolamento == "OK" and rolo.dobramento == "OK" and rolo.torcao_residual == "OK" and rolo.aspecto_visual == "OK" %}
          <span style="color: green;">‚úîÔ∏è</span>
        {% else %}
          <span style="color: red;">‚ùå</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>



<!-- Especifica√ß√£o de Norma -->
<h4 style="margin-top: 10px;">üìÑ Especifica√ß√£o de Norma</h4>
<table>
  <thead>
    <tr>
      <th>Especifica√ß√£o de Norma</th>
      <th><div class="circle-number">02</div> Resist√™ncia √† Tra√ß√£o (kgf/mm¬≤)</th>
      <th><div class="circle-number">11</div> Dureza (HR/HRb)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>
        {% if norma_tracao %}
          {% if norma_tracao.norma.vinculo_norma %}
            {{ norma_tracao.norma.vinculo_norma }}
          {% else %}
            {{ norma_tracao.norma.nome_norma }}
          {% endif %}
        {% else %}
          ‚Äî
        {% endif %}
      </td>
      <td>
        {% if norma_tracao %}
          {{ norma_tracao.resistencia_min|stringformat:"0.2f" }} ‚Äì {{ norma_tracao.resistencia_max|stringformat:"0.2f" }}
        {% else %}
          ‚Äî
        {% endif %}
      </td>
     <td>
        {% if norma_tracao and norma_tracao.dureza %}
          {{ norma_tracao.dureza|stringformat:"0.0f" }}
        {% else %}
          N/A
        {% endif %}
      </td>
    </tr>
  </tbody>
</table>


<!-- Status -->
<p><strong>Status Geral:</strong>
  {% if obj.status_geral == "Aprovado" %}
    <span class="status-aprovado">APROVADO ‚úîÔ∏è</span>
  {% elif obj.status_geral == "Aprovado Condicionalmente" %}
    <span class="status-condicional">APROVA√á√ÉO CONDICIONAL ‚ö†Ô∏è</span>
  {% else %}
    <span class="status-reprovado">REPROVADO ‚ùå</span>
  {% endif %}
</p>




<!-- Observa√ß√µes -->
{% if obj.observacoes or relacao.material_cliente %}
  <h4>üìù Observa√ß√µes</h4>
  <div style="font-size: 8pt; margin-bottom: 6px;">
    {% if relacao.material_cliente %}
      <p><span style="color: orange;">üõ°Ô∏è Material do Cliente</span></p>
    {% endif %}
    {{ obj.observacoes|linebreaks }}
  </div>
  <div style="border-top: 1px solid #000; margin: 6px 0;"></div>
{% endif %}


<!-- Assinatura -->
<h4 class= "mt-04">üßæ Respons√°vel</h4>
<div class="assinatura">
  Assinado digitalmente por <strong>{{ assinatura_nome }}</strong><br>
  ND: OU=Almoxarifado, o=Bras-Mol Molas e Estampados Ltda, CN={{ assinatura_email }}<br>
  Raz√£o: Eu estou aprovando este documento<br>
  Local: Itaquaquecetuba - SP<br>
  Data: {{ assinatura_data }}
</div>


<div style="position: fixed; bottom: 0; left: 0; right: 0; font-size: 7pt; padding: 6px 12px; border-top: 1px solid #000; display: flex; justify-content: space-between;">
  <div style="max-width: 85%;">
  <strong>Legenda:</strong>
    <span style="color: green;">‚úîÔ∏è Aprovado</span> |
    <span style="color: red;">‚ùå Reprovado</span> |
    <span style="color: orange;">‚ö†Ô∏è Aprovado Condicionalmente</span> |
    <span style="color: orange;">üõ°Ô∏è Material do Cliente</span><br>
    
    <strong>Caracter√≠sticas conforme PIR01 ‚Äì Tipo de Amostra e M√©todo:</strong><br>
    01 e 13 ‚Äì 1 corpo de prova no in√≠cio de cada rolo | Medi√ß√£o direta<br>
    02 ‚Äì Todos os certificados recebidos do fornecedor | POQ007 ‚Äì Compara√ß√£o visual<br>
    03, 04 ‚Äì Todos os certificados recebidos do fornecedor | POQ008 ‚Äì Compara√ß√£o visual<br>
    05, 06, 07, 08, 09, 12 ‚Äì Todos os certificados emitidos pelo fornecedor | Compara√ß√£o visual<br>
    11 ‚Äì 1 corpo de prova no in√≠cio e no final de cada rolo | POQ009
  </div>

  <div style="text-align: right; white-space: nowrap;">
    <strong>F045 - Rev. 14</strong>
  </div>
</div>


</body>
</html>