{% extends 'base.html' %}
{% block content %}
<h4>Confirmar Consolidação — {{ inventario.titulo }}</h4>

<p class="text-muted">
  Tipo: <strong>{{ inventario.get_tipo_display }}</strong> ·
  Status atual: <strong>{{ inventario.get_status_display }}</strong> ·
  Data de corte: {{ inventario.data_corte|date:"d/m/Y" }}
</p>

<div class="alert alert-warning">
  <strong>Atenção!</strong> A consolidação grava a quantidade final de todos os itens deste inventário.
  Caso existam divergências, a operação será bloqueada.
</div>

<ul class="list-group mb-3">
  <li class="list-group-item d-flex justify-content-between">
    <span>Total de itens</span> <strong>{{ total_itens }}</strong>
  </li>
  <li class="list-group-item d-flex justify-content-between">
    <span>Itens com 1ª contagem</span> <strong>{{ c1_preenchidas }}</strong>
  </li>
  <li class="list-group-item d-flex justify-content-between">
    <span>Itens com 2ª contagem</span> <strong>{{ c2_preenchidas }}</strong>
  </li>
  <li class="list-group-item d-flex justify-content-between">
    <span>Divergências pendentes</span>
    <strong class="{% if divergentes > 0 %}text-danger{% else %}text-success{% endif %}">
      {{ divergentes }}
    </strong>
  </li>
</ul>

<form method="post" action="{% url 'inventario_consolidar' inventario.pk %}">
  {% csrf_token %}
  <div class="form-check mb-3">
    <input class="form-check-input" type="checkbox" value="1" id="chk_confirma" required>
    <label class="form-check-label" for="chk_confirma">
      Confirmo que revisei as contagens e desejo consolidar este inventário.
    </label>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-outline-secondary" href="{% url 'inventario_detail' inventario.pk %}">Cancelar</a>
    <button class="btn btn-success" type="submit" {% if divergentes > 0 %}disabled{% endif %}>
      Consolidar agora
    </button>
  </div>
</form>

{% if divergentes > 0 %}
  <div class="alert alert-info mt-3">
    Existem divergências pendentes. A consolidação só será habilitada quando forem resolvidas em
    <a href="{% url 'inventario_confronto' inventario.pk %}">Confronto</a>.
  </div>
{% endif %}
{% endblock %}
