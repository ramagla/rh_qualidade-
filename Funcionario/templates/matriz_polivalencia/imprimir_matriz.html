{% extends 'base.html' %}
{% load custom_filters %}
{% load static %}

{% block content %}
{% include 'partials/global/_estilos_impressao_paisagem.html' %}
{% include 'partials/global/_botao_impressao.html' %}
{% include 'partials/global/_header_titulo.html' with titulo="Matriz de PolivalÃªncia" icone="bi bi-diagram-3" emoji="ðŸ“Œ" %}

<div class="container pdf-container" style="font-size: 9pt;">

  <!-- CabeÃ§alho da Matriz -->
<table class="custom-table info-table mb-3" style="font-size: 9pt;">
  <caption class="visually-hidden">InformaÃ§Ãµes da matriz de polivalÃªncia</caption>
  <thead>
    <tr>
      <td rowspan="2" class="text-center align-middle" style="width: 10%; border: 0.75pt solid #000; position: relative;">
  <img src="/static/logo.png" alt="Logo da empresa" style="width: 60px; height: auto;">
  <!-- ForÃ§a borda direita visÃ­vel -->
  <div style="
    position: absolute;
    top: 0;
    right: 0;
    width: 1px;
    height: 100%;
    background: #000;
  "></div>
</td>

      <td colspan="3" class="text-center fw-bold align-middle" style="border: 0.75pt solid #000; border-left: none;">
        <div style="font-size: 8.5pt; text-transform: uppercase;">
                      <i class="bi bi-diagram-3 me-1" aria-hidden="true"></i>

          MATRIZ DE POLIVALÃŠNCIA â€“ {{ matriz.departamento }}
        </div>
      </td>
      <td rowspan="2" class="text-center align-middle" style="width: 15%; font-size: 8pt; border: 0.75pt solid #000;">
        <strong>MP001 REV.: 01</strong><br>
        <span>21/09/14</span>
      </td>
    </tr>
    <tr>
      <td style="border: 0.75pt solid #000;"><strong>ElaboraÃ§Ã£o:</strong> {{ matriz.elaboracao }}</td>
      <td style="border: 0.75pt solid #000;"><strong>CoordenaÃ§Ã£o:</strong> {{ matriz.coordenacao }}</td>
      <td style="border: 0.75pt solid #000;"><strong>ValidaÃ§Ã£o:</strong> {{ matriz.validacao }}</td>
    </tr>
    <tr>
      <td colspan="5" style="text-align: right; border: 0.75pt solid #000;">
        <strong>Atualizado em:</strong> {{ matriz.atualizado_em|date:"d/m/Y" }}
      </td>
    </tr>
  </thead>
</table>



 <!-- Tabela Principal -->
<div class="table-responsive">
  <table class="custom-table info-table" style="font-size: 8pt;">
    <caption class="visually-hidden">Matriz de competÃªncias dos colaboradores</caption>
    <thead>
      <tr>
        <th rowspan="2" scope="col" style="
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  text-orientation: mixed;
  font-size: 7pt;
  font-weight: bold;
  text-align: center;
  vertical-align: middle;
  padding: 4px;
  line-height: 1;
">
  Colaborador
</th>

<th rowspan="2" scope="col" style="
  writing-mode: vertical-rl;
  text-orientation: mixed;
  font-size: 7pt;
  font-weight: bold;
  text-align: center;
  vertical-align: middle;
  padding: 4px;
  line-height: 1;
">
  <i class="bi bi-person-lines-fill text-secondary mb-1" aria-hidden="true"></i><br>
  <span style="transform: rotate(180deg); display: inline-block;">
    Suplente
  </span>
</th>


        {% for atividade in atividades %}
        <th scope="col" style="
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  text-orientation: mixed;
  font-weight: bold;
  text-align: center;
  vertical-align: middle;
  white-space: normal;
  word-break: break-word;
  overflow-wrap: break-word;
  padding: 2px 1px;
  font-size: 6pt;
  max-width: 35px;
  line-height: 1;
">



            {{ atividade.nome|auto_breaks:20|safe }}
            </th>

        {% endfor %}
      </tr>
    </thead>
    <tbody>
{% for colaborador in colaboradores|dictsort:"nome" %}
      <tr>
<td style="vertical-align: middle; font-size: 8pt;">
  {{ colaborador.nome|primeiro_nome }}
</td>
<td style="vertical-align: middle; text-align: center;">
  {% if colaborador.suplente %}
    <i class="bi bi-person-lines-fill text-secondary" title="Suplente" aria-label="Suplente"></i>
  {% else %}
    &mdash;
  {% endif %}
</td>
        {% for atividade in atividades %}
  <td style="vertical-align: middle; text-align: center;">
    {% with colaborador.id as colab_id %}
      {% with atividade.id as ativ_id %}
        {% for nota in notas_lista %}
          {% if nota.colaborador_id == colab_id and nota.atividade_id == ativ_id %}
            <img src="{% static nota.grafico %}" alt="NÃ­vel {{ nota.nivel }}: {{ nota.descricao }}" style="width: 18px; height: auto;">
          {% endif %}
        {% endfor %}
      {% endwith %}
    {% endwith %}
  </td>
{% endfor %}

      </tr>
      {% empty %}
      <tr>
        <td colspan="{{ atividades|length|add:2 }}" class="text-center text-muted">Nenhum colaborador com notas nesta matriz.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Legenda de NÃ­veis -->
<div class="mt-4 pt-3 border-top" style="border-top: 1px solid #000; font-size: 7pt;">
  <div class="d-flex flex-wrap gap-3 justify-content-center align-items-start">
    <div class="d-flex align-items-center gap-2">
      <strong>0</strong>
      <img src="{% static 'icons/barra_0.png' %}" alt="Nota 0" style="width: 14px;">
      <span>NÃ£o Treinado</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <strong>1</strong>
      <img src="{% static 'icons/barra_1.png' %}" alt="Nota 1" style="width: 14px;">
      <span>Tarefas bÃ¡sicas com acompanhamento</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <strong>2</strong>
      <img src="{% static 'icons/barra_2.png' %}" alt="Nota 2" style="width: 14px;">
      <span>Tarefas chave com acompanhamento</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <strong>3</strong>
      <img src="{% static 'icons/barra_3.png' %}" alt="Nota 3" style="width: 14px;">
      <span>Qualificado sem acompanhamento</span>
    </div>
    <div class="d-flex align-items-center gap-2">
      <strong>4</strong>
      <img src="{% static 'icons/barra_4.png' %}" alt="Nota 4" style="width: 14px;">
      <span>Qualificador</span>
    </div>
  </div>
</div>


  {% include 'partials/global/_formulario_rodape.html' with numero_formulario="MP001 Rev. 01" %}
</div>
{% endblock %}
