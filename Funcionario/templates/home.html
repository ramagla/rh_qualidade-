{% extends 'base.html' %}
{% load static %}

{% block title %}Dashboard{% endblock %}

{% block content %}
{% comment %} <div class="header d-flex align-items-center mb-3" style="font-family: Arial, sans-serif;">
    <!-- Logo escuro da empresa -->
    <div class="left-section me-2">
        {% if settings.logo_escuro %}
            <img src="{{ settings.logo_escuro.url }}" alt="Logotipo Escuro" style="width: 50px; height: auto;">
        {% else %}
            <img src="{% static 'logo.png' %}" alt="Logotipo Padrão" style="width: 50px; height: auto;">
        {% endif %}
    </div>

    <!-- Barra de separação reduzida -->
    <div style="border-left: 1px solid #ddd; height: 60px; margin-right: 10px;"></div>
    
    <!-- Informações da empresa com fonte reduzida -->
    <div class="center-section text-start" style="font-size: 10px; color: #4a4a4a;">
        <strong style="font-size: 10px; color: #333;">{{ settings.nome_empresa }}</strong><br>
        <span><strong>CEP:</strong> {{ settings.cep }}</span><br>
        <span>{{ settings.endereco }}</span><br>
        <span><strong>Fone:</strong> {{ settings.telefone }} - <strong>E-mail:</strong> {{ settings.email }}</span><br>
        <span><strong>CNPJ:</strong> {{ settings.cnpj }}</span>
    </div>

    <!-- Barra de separação reduzida -->
    <div style="border-left: 1px solid #ddd; height: 60px; margin-left: 10px; margin-right: 10px;"></div>

    <!-- Data de impressão -->
    <div class="right-section text-end" style="font-size: 10px; color: #4a4a4a;">
        <span><strong>Data de Impressão:</strong> <span id="data-impressao"></span></span><br>
    </div>
</div>

<hr style="border-top: 1px solid #ddd; margin-top: 10px; margin-bottom: 10px;"> {% endcomment %}

<!-- Conteúdo principal -->
<div class="row mt-4">
    <!-- Coluna de Comunicados Recentes -->
    <div class="col-md-4">
        <h5 class="text-center">Últimos Comunicados</h5>
        {% if comunicados %}
            {% for comunicado in comunicados %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-title">{{ comunicado.assunto }}</h6>
                        <p class="card-text">
                            <small class="text-muted">{{ comunicado.data|date:"d/m/Y" }}</small><br>
                            <strong>Departamento:</strong> {{ comunicado.departamento_responsavel }}
                        </p>
                        <button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#comunicadoModal{{ comunicado.id }}">
                            <i class="bi bi-eye"></i> Visualizar
                        </button>
                    </div>
                </div>

                <!-- Modal para visualizar a descrição do comunicado -->
                <div class="modal fade" id="comunicadoModal{{ comunicado.id }}" tabindex="-1" aria-labelledby="comunicadoModalLabel{{ comunicado.id }}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="comunicadoModalLabel{{ comunicado.id }}">{{ comunicado.assunto }}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                {{ comunicado.descricao|safe }}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">Nenhum comunicado recente.</p>
        {% endif %}
    </div>

    <!-- Coluna de Funcionários com Avaliação Baixa -->
    <div class="col-md-4">
        <h5 class="text-center">Funcionários com Avaliação Baixa</h5>
        {% if funcionarios_avaliacao_baixa %}
            {% for funcionario in funcionarios_avaliacao_baixa %}
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-title">{{ funcionario.nome }}</h6>
                        <p class="card-text">Avaliação: {{ funcionario.avaliacao }}</p>
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <p class="text-muted">Nenhum funcionário com avaliação baixa.</p>
        {% endif %}
    </div>

  <!-- Coluna de Próximas Atualizações do Sistema -->
<div class="col-md-4">
    <h5 class="text-center">Próximas Atualizações do Sistema</h5>
    {% if proximas_atualizacoes %}
        {% for atualizacao in proximas_atualizacoes %}
            <div class="card mb-3">
                <div class="card-body">
                    <h6 class="card-title">{{ atualizacao.versao }}</h6>
                    <h5 class="card-title">{{ atualizacao.titulo }}</h5>
                    <p class="card-text">{{ atualizacao.descricao }}</p>
                    <p class="text-muted">Previsão: {{ atualizacao.previsao|date:"d/m/Y" }}</p>
                    <!-- Exibir o status com a regra de cores -->
                    <p class="card-text">
                        <span class="badge 
                            {% if atualizacao.status == 'concluido' %} bg-success 
                            {% elif atualizacao.status == 'em_andamento' %} bg-warning 
                            {% elif atualizacao.status == 'cancelado' %} bg-danger 
                            {% else %} bg-secondary {% endif %}">
                            {{ atualizacao.status|capfirst }}
                        </span>
                    </p>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="text-muted">Nenhuma atualização registrada.</p>
    {% endif %}
</div>


<script>
    // Script para exibir a data de impressão
    document.addEventListener("DOMContentLoaded", function() {
        const dataImpressao = document.getElementById('data-impressao');
        if (dataImpressao) {
            dataImpressao.textContent = new Date().toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
    });
</script>

{% endblock %}
