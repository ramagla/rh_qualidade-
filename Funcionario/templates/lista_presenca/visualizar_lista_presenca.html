{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% load tz %}

{% block title %}Visualiza√ß√£o da Lista de Presen√ßa{% endblock %}

{% block content %}
  {% include "partials/global/_estilos_impressao.html" %}
  {% include "partials/global/_botao_impressao.html" %}
  {% include "header.html" %}

  <div id="relatorio-area">
    <div class="pdf-container">
      <!-- Cabe√ßalho -->
      <div class="pdf-header text-center">
        <h1>üìù Lista de Presen√ßa</h1>
        <p>Visualiza√ß√£o detalhada do registro</p>
      </div>

      <!-- Conte√∫do -->
      <div class="pdf-content">
        <div class="table-responsive">
          <table class="table table-bordered info-table align-middle">
            <tr>
              <th>Tipo</th>
              <td>{{ lista.treinamento }}</td>
            </tr>
            <tr>
              <th>Assunto</th>
              <td>{{ lista.assunto }}</td>
            </tr>
            <tr>
              <th>Descri√ß√£o</th>
              <td>{{ lista.descricao|safe }}</td>
            </tr>
            <tr>
              <th>Data de In√≠cio</th>
              <td>{{ lista.data_inicio|date:"d/m/Y" }}</td>
            </tr>
            <tr>
              <th>Data de Fim</th>
              <td>{{ lista.data_fim|date:"d/m/Y" }}</td>
            </tr>
            <tr>
  <th class="align-middle">Dura√ß√£o</th>
  <td class="align-middle">
    <i class="bi bi-hourglass-split me-1"></i>
    {{ lista.duracao|formatar_duracao }}
  </td>
</tr>

            <tr>
              <th>Hor√°rio In√≠cio</th>
              <td>{{ lista.horario_inicio }}</td>
            </tr>
            <tr>
              <th>Hor√°rio Fim</th>
              <td>{{ lista.horario_fim }}</td>
            </tr>
            <tr>
              <th>Instrutor</th>
              <td>{{ lista.instrutor }}</td>
            </tr>
            <tr>
              <th>Necessita Avalia√ß√£o?</th>
              <td>{{ lista.necessita_avaliacao|yesno:"Sim,N√£o" }}</td>
            </tr>
            <tr>
  <th class="align-middle">Situa√ß√£o</th>
  <td class="align-middle">
    {% if lista.situacao == "planejado" %}
      <span class="badge bg-warning text-dark">
        <i class="bi bi-hourglass-split me-1"></i> Planejado
      </span>
    {% elif lista.situacao == "em_andamento" %}
      <span class="badge bg-info text-dark">
        <i class="bi bi-play-circle me-1"></i> Em Andamento
      </span>
    {% elif lista.situacao == "finalizado" %}
      <span class="badge bg-success">
        <i class="bi bi-check-circle-fill me-1"></i> Finalizado
      </span>
    {% else %}
      <span class="badge bg-secondary">
        <i class="bi bi-question-circle me-1"></i> {{ lista.situacao|capfirst }}
      </span>
    {% endif %}
  </td>
</tr>

            <tr>
              <th>Arquivo PDF</th>
              <td>
                {% if lista.lista_presenca %}
                  <a href="{{ lista.lista_presenca.url }}" class="btn btn-info btn-sm">
                    <i class="bi bi-download"></i> Baixar Lista
                  </a>
                  <span class="small text-muted">({{ lista.lista_presenca.name|basename }})</span>
                {% else %}
                  N√£o dispon√≠vel
                {% endif %}
              </td>
            </tr>
          </table>
        </div>

        <!-- Participantes -->
        <h5 class="text-primary mt-4">üë• Participantes</h5>
        <ul class="list-group mt-2">
          {% for participante in lista.participantes.all %}
            <li class="list-group-item">{{ participante.nome }} ‚Äì {{ participante.local_trabalho }}</li>
          {% empty %}
            <li class="list-group-item text-muted">Nenhum participante registrado.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Rodap√© -->
      <div class="text-center text-muted small mt-4">
  <i class="bi bi-clock me-1"></i>
  Relat√≥rio gerado em {{ now|date:"d/m/Y H:i" }}

        </p>
        <p class="mb-0 fst-italic">
          {% include "partials/global/_rodape_institucional.html" %}
        </p>
      </div>
    </div>

    <!-- Bot√£o Voltar -->
    <div class="text-center mt-4 d-print-none">
      <a href="{% url 'lista_presenca' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left-circle"></i> Voltar
      </a>
    </div>
  </div>
{% endblock %}
