{% load widget_tweaks %}

<form method="post" novalidate>
  <input type="hidden" name="aba" value="regras">
  <input type="hidden" name="form_regras_submitted" value="1">
  {% csrf_token %}

  <div class="row bg-regras p-4 rounded shadow-sm">
    <div class="col-12 col-lg-10 offset-lg-1">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h5 class="mb-4 d-flex align-items-center">
            <i class="bi bi-calculator-fill text-info fs-4 me-2"></i>
            Regras de Cálculo Tributário
          </h5>

          {% if form_regras.errors %}
            <div class="alert alert-danger">
              <strong>Erros no formulário:</strong>
              <ul class="mt-2 mb-0">
                {% for field in form_regras %}
                  {% for error in field.errors %}
                    <li><strong>{{ field.label }}:</strong> {{ error }}</li>
                  {% endfor %}
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">

            <!-- ICMS -->
            <div>
              <label class="form-label" title="Imposto Estadual padrão da cotação">
                <i class="bi bi-bank text-secondary me-1"></i> ICMS (%) <small class="text-muted">({{ cotacao.icms }}%)</small>
              </label>
              {{ form_regras.icms|add_class:"form-control" }}
            </div>

            <!-- PIS -->
            <div>
              <label class="form-label" title="Programa de Integração Social">
                <i class="bi bi-cash-coin text-secondary me-1"></i> PIS (%)
              </label>
              {{ form_regras.pis|add_class:"form-control" }}
            </div>

            <!-- COFINS -->
            <div>
              <label class="form-label" title="Contribuição para o Financiamento da Seguridade Social">
                <i class="bi bi-cash-stack text-secondary me-1"></i> COFINS (%)
              </label>
              {{ form_regras.confins|add_class:"form-control" }}
            </div>

            <!-- IR -->
            <div>
              <label class="form-label" title="Imposto de Renda Pessoa Jurídica">
                <i class="bi bi-currency-dollar text-secondary me-1"></i> IR (%)
              </label>
              {{ form_regras.ir|add_class:"form-control" }}
            </div>

            <!-- CSLL -->
            <div>
              <label class="form-label" title="Contribuição Social sobre o Lucro Líquido">
                <i class="bi bi-file-earmark-text text-secondary me-1"></i> CSLL (%)
              </label>
              {{ form_regras.csll|add_class:"form-control" }}
            </div>

            <!-- DF -->
            <div>
              <label class="form-label" title="Despesas Fixas estimadas para o cálculo">
                <i class="bi bi-gear-fill text-secondary me-1"></i> DF (%)
              </label>
              {{ form_regras.df|add_class:"form-control" }}
            </div>

            <!-- DV -->
            <div>
              <label class="form-label" title="Despesas Variáveis estimadas para o cálculo">
                <i class="bi bi-graph-up-arrow text-secondary me-1"></i> DV (%)
              </label>
              {{ form_regras.dv|add_class:"form-control" }}
            </div>
          </div>

          <!-- Botão -->
          <div class="text-end mt-4">
            <button type="submit" class="btn btn-primary px-4">
              <i class="bi bi-check2-circle me-1"></i> Salvar Regras
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</form>
